<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transformación Halloweenia</title>
    <link rel="stylesheet" href="style.css">
    <link rel="shortcut icon" href="static/images/favicon.png" type="image/x-icon">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11" defer></script>
</head>
<body>
    <div class="halloween-container">
        <nav style="text-align:left; margin-bottom: 10px; display:flex; gap:12px; flex-wrap:wrap;">
            <a href="/" style="color:#ff9900; text-decoration:none;">Inicio</a>
            <a href="/galeria" style="color:#ff9900; text-decoration:none;">Galería</a>
            <a id="howToLink" href="#" style="color:#ff9900; text-decoration:none;">Cómo usar</a>
            <a id="creditsLink" href="#" style="color:#ff9900; text-decoration:none;">Créditos</a>
        </nav>
        <h1>🎃 Tu Álter Ego👻</h1>
        <h2 class="halloween-title" style="color:#F06406;">👻 Halloween by Polygonus 🎃</h2>
        <div class="upload-section">
            <div class="upload-container halloween-theme" id="dropZone">
                <div class="upload-content">
                    <div class="halloween-icon">
                        <img src="static/images/pumpkin-upload-icon.svg" alt="Subir imagen" class="upload-icon">
                    </div>
                    <p class="upload-text">¡Atrévete a subir tu foto!</p>
                    <p class="upload-subtext">Arrástrala aquí o haz clic para seleccionar</p>
                    <div class="halloween-bats">
                        <div class="bat">🦇</div>
                        <div class="bat bat-2">🦇</div>
                        <div class="bat bat-3">🦇</div>
                    </div>
                    <input type="file" id="userImage" accept="image/*" hidden>
                </div>
                <div class="halloween-border"></div>
            </div>
            <div class="preview-container" id="previewContainer" style="display: none;">
                <div class="preview-content">
                    <div class="preview-frame">
                        <div class="frame-top">🎃</div>
                        <div class="frame-side frame-left">🎃</div>
                        <img id="previewImage" src="#" alt="Previsualización" class="preview-image">
                        <div class="frame-side frame-right">🎃</div>
                        <div class="frame-bottom">🎃</div>
                    </div>
                    <button class="change-image-btn" id="changeImageBtn">
                        <span class="btn-icon">🔄</span> Cambiar imagen
                    </button>
                </div>
            </div>
        </div>

        <div class="selectors-section">
            <label for="disfrazSelector">Elige tu Disfraz:</label>
            <select id="disfrazSelector">
                <option value="vampire">Vampiro Elegante</option>
                <option value="witch">Bruja Moderna</option>
                <option value="zombie">Zombie Glamuroso</option>
                <option value="werewolf">Hombre Lobo Aullador</option>
                <option value="ghost">Fantasma Etéreo</option>
            </select>

            <label for="soundSelector">Elige tu Sonido:</label>
            <select id="soundSelector">
                <option value="scream">Grito Espeluznante</option>
                <option value="haunted_murmur">Murmullo Fantasmal</option>
                <option value="evil_laugh">Risa Malévola</option>
                <option value="wolf_howl">Aullido de Lobo</option>
            </select>

            <label for="displayName" style="margin-top:10px; display:block;">No seas timod@ deja tu nombre <br> (mín. 5 caracteres):</label>
            <input id="displayName" type="text" placeholder="Ej: Lenin Mendoza" minlength="5" required style="width:100%; max-width:480px;">

            <label for="extraPrompt" style="margin-top:10px; display:block;">Prompt extra (opcional):</label>
            <input id="extraPrompt" type="text" placeholder="Ej: ojos brillantes verdes, mantener fondo original" style="width:100%; max-width:480px;">

            <div style="margin-top:8px;">
                <input type="checkbox" id="useThematicBg" checked>
                <label for="useThematicBg">Usar fondo temático (reemplazar fondo acorde al disfraz)</label>
            </div>
        </div>

        <button id="transformButton">¡Transformar y Animar!</button>

        <div id="results" class="results-section">
            <h2>Tu Transformación:</h2>
            <div class="image-stage" style="display:none;">
                <img id="transformedImage" src="#" alt="Imagen Transformada" style="max-width: 400px;">
                <img id="themeOverlay" alt="Overlay Temático" style="display:none;">
                <!-- Canvas de brasas creativas (Fase 4) -->
                <canvas id="emberCanvas" style="display:none;"></canvas>
            </div>
            <div id="downloadArea" style="display:none; margin-top:10px;">
                <a id="downloadResultBtn" class="download-btn" href="#" download>Descargar imagen</a>
            </div>
            <div style="margin-top:10px;">
                <button id="emberToggleBtn" class="download-btn" style="display:none;">Activar brasas ✨🔥</button>
            </div>
            <video id="halloweenAnimation" controls loop style="display:none; max-width: 400px; margin-top: 15px;"></video>
            <audio id="halloweenSound" controls style="display:none; margin-top: 10px;"></audio>
            <div id="playSoundArea" style="margin-top:10px;">
                <button id="playSoundBtn" class="download-btn" style="display:none;">Reproducir sonido</button>
            </div>
            <!-- Brochure narrativo (se llena dinámicamente) -->
            <div id="brochureContainer" style="display:none; margin-top:16px;"></div>
            <p id="loadingMessage" style="display:none;">Procesando tu magia de Halloween <br> esto puede tardar un poco...</p>
            <div id="spinner" aria-hidden="true" style="display:none;"></div>
            <!-- <div id="aiStatus" style="display:none; margin-top:8px; font-size: 0.95rem;"></div> -->
        </div>
    </div>
    <script src="script.js"></script>
</body>
</html>